# EPFL eVoting ops

## Purpose

The goal of this repository is to deploy a minimal eVoting service based on 
the [dvoting][dvoting-repo] system with Ansible. This includes N (N>=4) conodes and a web frontend.
This is an attempt to _ansibilize_ Linus's [scripts][linus-scripts]

## Usage

```bash
# ./votsible
```

## Demo setup
We have a number of VMs that can be used to demo the system. It will not be 
suitable for production as all the nodes are in our hands, but it is easier
to setup and enables fast setup of a nice test bed.

Start by resetting everything on the demo target machines:

```bash
./votsible.sh --demo -t reset -t reset_docker_yes_yes_please -t yes_please_reset_docker_volumes_too
```

The installation in steps:
 1. install traefik
 2. install and start all conodes
 3. configure the node network by exchanging the node configs and keys. This
    can be done in three ways:
    * fully _automatic_ (but apparently not yet working) where the commands
      on the nodes are run by ansible itself;
    * fully _automatic_ where ansible first generate bash scripts and then
      execute them
    * manually by ruinning the scripts that are generated by ansible. The
      scripts can be found on each machine at `/srv/dela_demo/init/`
 4. install and configure the web interface
 5. configure the proxy address (used by the browser to contact the nodes)

```bash
./votsible.sh --demo -t traefik

./votsible.sh --demo -t dela
# either join using ansible docker run
./votsible.sh --demo -t dela -t dela.join
# or     join using bash scripts
./votsible.sh --demo -t dela -t dela.manual_join
# or     just run the scripts in /srv/dela_demo/init/ by hand on each machine

./votsible.sh --demo -t dvoting

./bin/fix_proxies.sh
```

### Dev login and vote randomizer
For development / testing purposes, in non-`prod` environments, login is faked
and the same person will cast a new vote each time so that one can easily
simulate many people voting with a single faked login.

In production off-course this is not activated and people will have to login
via tequila and, in case they vote multiple times, only the last vote will 
be retained.

In order to test the production configuration in the demo environment, you have
to disable the default behaviour by re-reconfiguing the backend with

```bash
RANDOMIZE=false DEVLOGIN=false  ./votsible.sh --demo -t dvoting.run
```

### Debugging
Traefik console for the web app should be visible [here](https://evtraefik.fsd.team/dashboard)__

### Examples

### Only on one host

```bash
./votsible  --prod
./votsible  --qual
./votsible  --test
./votsible  --demo
#./votsible  --dev
```

### Specifying a tag

```bash
./votsible --test -t "test"
```

### Specifying multiple tags

```bash
./votsible --test -t "tag1,tag2,tag3"
```

### Skip specifying a tag

```bash
./votsible --test --skip-tags "github_key_import"
```

### Skip specifying multiple tags

```bash
./votsible --test -skip-tags "tag1,tag2,tag3"
```




## Notes

### Git tags
| TAG | Short | Description |
| --- | ----- | ----------- |
| add | When the project welcome new files
| btf | Changes that do not affect the meaning of the code (beautifulage)
| cnf | Changes in app configuration files
| doc | Documentation only changes
| fix | A bug fix
| fea | A new feature
| hoc | Repository cleanup (HouseCleaning)
| ign | When adding a .gitignore file or similar
| oth | Other changes that don't modify src or test files
| rfa | A code change (refactor) that neither fixes bug nor adds a feature
| rvt | Reverts a previous commit
| tag | When adding a tag reference
| tst | Adding missing tests or correcting existing tests
| wip | Work in progress. E.g. in case of fire

### Links
 * C4DT D-Voting GitHub fork [repository][dvoting-repo]
 * C4DT Dela GitHub fork [repository][dela-repo]
 * D-Voting [Kanban][dvoting-kanban] and [issues][dvoting-issues]
 * Current [demo][dedis-demo] hosted by dedis
 * Reference [scripts][linus-scripts]
[linus-scripts]: https://github.com/c4dt/dela-scripts
[dvoting-repo]: https://github.com/c4dt/d-voting
[dela-repo]: https://github.com/c4dt/dela
[dvoting-issues]: https://github.com/c4dt/d-voting/issues
[dvoting-kanban]: https://github.com/orgs/c4dt/projects/6
[dedis-demo]: https://dvoting.c4dt.org


